try{window.AudioContext=window.AudioContext||window.webkitAudioContext,window.audioContext=new window.AudioContext}catch(e){console.log("No Web Audio API support")}const WebAudioAPISoundManager=function(e){this.context=e,this.bufferList={},this.playingSounds={}},WebAudioAPISound=(WebAudioAPISoundManager.prototype={addSound:function(t){var e=new XMLHttpRequest,n=(e.open("GET",t,!0),e.responseType="arraybuffer",this);e.onload=function(){n.context.decodeAudioData(e.response,function(e){e?n.bufferList[t]=e:console.log("error decoding file data: "+t)})},e.onerror=function(){console.log("BufferLoader: XHR error")},e.send()},stopSoundWithUrl:function(e){if(this.playingSounds.hasOwnProperty(e))for(var t in this.playingSounds[e])this.playingSounds[e].hasOwnProperty(t)&&this.playingSounds[e][t].stop()}},function(e){this.url=e+".mp3",window.webAudioAPISoundManager=window.webAudioAPISoundManager||new WebAudioAPISoundManager(window.audioContext),this.manager=window.webAudioAPISoundManager,this.manager.addSound(this.url)}),moveSound=(WebAudioAPISound.prototype={play:function(e){var t,n=this.manager.bufferList[this.url];for(t in this.settings={loop:!1,volume:.5},e)e.hasOwnProperty(t)&&(this.settings[t]=e[t]);void 0!==n&&((n=this.makeSource(n)).loop=this.settings.loop,n.start(0),this.manager.playingSounds.hasOwnProperty(this.url)||(this.manager.playingSounds[this.url]=[]),this.manager.playingSounds[this.url].push(n))},stop:function(){this.manager.stopSoundWithUrl(this.url)},makeSource:function(e){var t=this.manager.context.createBufferSource(),n=this.manager.context.createGain();return n.gain.value=this.settings.volume,t.buffer=e,t.connect(n),n.connect(this.manager.context.destination),t}},new WebAudioAPISound("sounds/move")),coinSound=new WebAudioAPISound("sounds/coin"),startFieldSound=new WebAudioAPISound("sounds/startField"),winSound=new WebAudioAPISound("sounds/win"),clickMeSound=new WebAudioAPISound("sounds/clickMe"),btnClickSound=new WebAudioAPISound("sounds/btnClick"),settingsClick=new WebAudioAPISound("sounds/settingsClick"),tikTak=new WebAudioAPISound("sounds/tikTak"),swosh=new WebAudioAPISound("sounds/swosh"),swoshTimer=new WebAudioAPISound("sounds/swoshTimer"),timerTik=new WebAudioAPISound("sounds/timerTik"),timerEnd=new WebAudioAPISound("sounds/timerEnd"),swoshFlip=new WebAudioAPISound("sounds/swoshFlip"),titleStart=new WebAudioAPISound("sounds/title1"),titleEnd=new WebAudioAPISound("sounds/title2"),game=(window.onload=function(){const e=document.getElementById("preloader");e.classList.add("preloader_hide"),setTimeout(function(){e.classList.add("preloader_hidden")},990),game.elements.settingsForm.style.display="none"},{states:{canBeMoved:!(document.getElementById("startPageBtn").onclick=function(){document.getElementById("startPageBtn").setAttribute("disabled",!0),game.elements.startPage.classList.add("startPage_hide"),setTimeout(function(){game.elements.startPage.classList.add("startPage_hidden"),game.elements.header.classList.remove("header_startPosition"),game.elements.field.classList.remove("field_startPosition"),game.elements.title.classList.add("title_startAnimation"),setTimeout(function(){titleStart.play({volume:.075})},1e3),setTimeout(function(){titleEnd.play({volume:.15})},2850),setTimeout(function(){swosh.play({volume:.1})},4250),setTimeout(function(){game.timerStart.stop(),game.timerStart.reset(),game.timerStart.start()},5e3),setTimeout(function(){game.elements.field.classList.add("field_defaultPosition")},5750)},490)}),win:!1,progress:0,animation3D:!0,animationForFocus3D:!1},settings:{sensitivity3D:25,speed3D:2},elements:{startPage:document.getElementById("startPage"),startPageBtn:document.getElementById("startPageBtn"),title:document.getElementById("title"),header:document.getElementById("header"),field:document.getElementById("field"),fieldCube:document.getElementById("fieldCube"),progress:document.getElementById("progress"),startBtn:document.getElementById("start"),settingsBtn:document.getElementById("settings"),settingsForm:document.getElementById("settingsForm"),sensitivity3DRange:document.getElementById("sensitivity3D"),speed3DRange:document.getElementById("speed3D"),animationForFocusFieldset3D:document.getElementById("3DanimationForFocusFieldset"),sensitivity3DFieldset:document.getElementById("sensitivity3DFieldset"),speed3DFieldset:document.getElementById("speed3DFieldset"),disableElements:[document.getElementById("3DanimationForFocusFieldset"),document.getElementById("sensitivity3DFieldset"),document.getElementById("speed3DFieldset")]},timer:{el:document.getElementById("timer"),time:0,set:0,start:function(){game.timer.set=setInterval(function(){game.timer.tik(),game.timer.draw()},1e3)},tik:function(){game.timer.time++},draw:function(){let e="0"+game.timer.time%60,t="0"+Math.floor(game.timer.time/60);game.timer.el.textContent=t.slice(-2)+":"+e.slice(-2)},stop:function(){clearInterval(game.timer.set)},reset:function(){game.timer.time=0,game.timer.el.textContent="00:00"}},timerStart:{el:document.getElementById("timerStart"),elBlur:document.getElementById("blur"),elParts:document.getElementsByClassName("timerStart__part"),drawNumber:function(e){for(let e=0;e<game.timerStart.elParts.length;e++)game.timerStart.elParts[e].classList.remove("timerStart__part_active");let t;3==e?t=[1,3,5,6,7]:2==e?t=[1,3,4,6,7]:1==e?t=[3,5]:0==e&&(t=[1,2,3,4,5,6]);for(let e=0;e<t.length;e++)game.timerStart.elParts[t[e]-1].classList.add("timerStart__part_active")},time:3,set:0,randomTextSet:0,start:function(){if(game.elements.header.classList.remove("header_win"),game.randomize(2e3),game.states.canBeMoved=!1,setTimeout(function(){game.classUpdate()},200),randomTextSet=setInterval(function(){for(let e=0;e<game.cells.td.length;e++){var t=getRandomInt(0,16);game.cells.td[e].querySelector(".cell__sideNumber").textContent=t,game.cells.td[e].querySelector(".cell__number").textContent=t}},200),game.timer.stop(),game.timer.reset(),game.cells.cubes[0].classList.contains("cell__cube_3D"))for(let e=0;e<game.cells.cubes.length;e++)game.cells.cubes[e].classList.remove("cell__cube_3D");game.elements.fieldCube.hasAttribute("style")&&(game.elements.fieldCube.style.transition="transform 1s linear",game.elements.fieldCube.style.transform=`rotatey(${-degSettings}deg) rotatex(0deg)`),game.elements.field.style.transition="transform 3s linear",game.elements.field.style.transform="scale(0.95)",document.body.removeEventListener("mousemove",mouseRotate),game.elements.startBtn.setAttribute("disabled",!0),game.elements.settingsBtn.setAttribute("disabled",!0),clearInterval(floatingSet),game.timerStart.el.classList.add("timerStart_visible"),game.timerStart.el.classList.add("timerStart_front"),swoshTimer.play({volume:.1}),game.timerStart.elBlur.classList.add("blur_visible"),game.timerStart.set=setInterval(function(){game.timerStart.tik(),game.timerStart.draw()},1e3)},tik:function(){game.timerStart.time--},draw:function(){game.timerStart.drawNumber(game.timerStart.time),tikTak.play({volume:.8}),(0!=game.timerStart.time?timerTik:timerEnd).play({volume:.1}),0==game.timerStart.time&&(game.elements.fieldCube.style.transition="transform 0.5s ease-in",game.elements.field.style.transition="transform 2s ease",game.elements.fieldCube.style.transform=`rotatey(${-degSettings}deg) rotatex(0deg)`,game.elements.field.style.transform="scale(1)"),0==game.timerStart.time&&(swoshTimer.play({volume:.1}),game.timerStart.stop(),game.timerStart.el.classList.remove("timerStart_front"),game.timerStart.el.classList.add("timerStart_back"),game.timerStart.elBlur.classList.remove("blur_visible"),clearInterval(randomTextSet),resetAnimation(game.elements.field,"field_glow"),game.elements.field.classList.add("field_glow"),game.draw(),game.classUpdate(),game.states.win=!1,game.states.canBeMoved=!0,setTimeout(function(){game.timerStart.el.classList.remove("timerStart_visible"),game.timerStart.el.classList.remove("timerStart_back"),game.elements.startBtn.removeAttribute("disabled"),game.elements.settingsBtn.removeAttribute("disabled"),game.start(),document.body.addEventListener("mousemove",mouseRotate)},500))},stop:function(){clearInterval(game.timerStart.set)},reset:function(){game.timerStart.time=3,game.timerStart.drawNumber(game.timerStart.time)}},field:{width:4,height:4,numberOfCells:16},cells:{td:document.getElementsByClassName("cell"),cubes:document.getElementsByClassName("cell__cube"),sides:document.getElementsByClassName("cell__side"),originalRanking:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,null],ranking:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,null],borders:{top:[0,1,2,3],right:[3,7,11,15],bottom:[12,13,14,15],left:[0,4,8,12]},directions:{top:[11,7,3],right:[],bottom:[],left:[14,13,12]},newBorder:function(){game.cells.borders.top.length=0,game.cells.borders.right.length=0,game.cells.borders.bottom.length=0;for(let e=game.cells.borders.left.length=0;e<game.field.numberOfCells;e++)0==e&&(game.cells.borders.left.push(e),game.cells.borders.right.push(e+game.field.width-1)),e<game.field.width&&game.cells.borders.top.push(e),0!=e&&e%game.field.width==0&&(game.cells.borders.left.push(e),game.cells.borders.right.push(e+game.field.width-1)),e>=game.field.numberOfCells-game.field.width&&game.cells.borders.bottom.push(e)},newDirection:function(){var e,t=game.cells.ranking.indexOf(null);let n,s;for(e in game.cells.directions)for(game.cells.directions[e].length=0,n=!1,s=t;0==n;)game.cells.borders[e].includes(t)?n=!0:(s-=game.getStep(e),game.cells.directions[e].push(s),game.cells.borders[e].includes(s)&&(n=!0))}},start:function(){game.timer.start()},reset:function(){game.cells.ranking=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,null],game.timer.stop(),game.timer.reset(),game.draw(),game.cells.newDirection(),game.classUpdate()},moving:function(e,n){var s=game.checkMove(e);if(s){var a=game.getArrayCells(e,s);if(n){moveSound.play({volume:.15}),game.states.canBeMoved=!1;for(let e=0;e<a.length;e++)game.cells.td[game.cells.ranking.indexOf(a[e])].style.transition="all .1s linear",game.cells.td[game.cells.ranking.indexOf(a[e])].classList.add("cell_"+s),game.cells.ranking.indexOf(a[e])+game.getStep(s)+1==a[e]?(game.cells.td[game.cells.ranking.indexOf(a[e])].classList.add("cell_coincidence"),coinSound.play({volume:.1})):game.cells.td[game.cells.ranking.indexOf(a[e])].classList.remove("cell_coincidence")}let t=[];for(let e=0;e<a.length;e++)t.push(game.cells.ranking.indexOf(a[e]));for(let e=0;e<a.length;e++)game.cells.ranking[t[e]+game.getStep(s)]=a[e];game.cells.ranking[t[0]]=null,game.states.progress=game.states.progress+t.length,game.elements.progress.textContent=game.states.progress}},draw:function(){for(let e=0;e<game.cells.td.length;e++)game.cells.td[e].querySelector(".cell__sideNumber").textContent=game.cells.ranking[e],game.cells.td[e].querySelector(".cell__number").textContent=game.cells.ranking[e]},checkMove:function(e){for(var t in game.cells.directions)if(game.cells.directions[t].includes(e))return t;return!1},getArrayCells:function(e,t){let n=[];for(var s=game.getStep(t);null!=game.cells.ranking[e];e+=s)n.push(game.cells.ranking[e]);return n},getStep:function(e){return"top"==e?game.field.width:"right"==e?-1:"bottom"==e?-game.field.width:"left"==e?1:void 0},classUpdate:function(){for(let e=0;e<game.cells.ranking.length;e++)game.cells.td[e].classList.remove("cell_null","cell_coincidence"),game.cells.ranking[e]==e+1?game.cells.td[e].classList.add("cell_coincidence"):null===game.cells.ranking[e]&&game.cells.td[e].classList.add("cell_null")},randomize:function(t){for(let e=0;e<t;e++)game.moving(game.getRandom(),!1),game.cells.newDirection(),e!=t-1||null==game.cells.ranking[game.cells.ranking.length-1]&&1==equalArrays(game.cells.originalRanking,game.cells.ranking)||e--;game.states.progress=0,game.elements.progress.textContent=game.states.progress},getRandom:function(){var e=game.cells.directions.top.concat(game.cells.directions.right,game.cells.directions.bottom,game.cells.directions.left);return e[Math.floor(Math.random()*e.length)]},checkWin:function(){return equalArrays(game.cells.originalRanking,game.cells.ranking)==game.cells.originalRanking.length&&(game.states.win=!0,game.timer.stop(),!0)},flip:function(){swoshFlip.play({volume:.125});var e=Number(game.settings.speed3D)/Number(game.elements.speed3DRange.getAttribute("max"))*(1.15-.8)+.8;game.elements.startBtn.setAttribute("disabled",!0),game.elements.settingsBtn.setAttribute("disabled",!0),clearInterval(floatingSet),document.body.removeEventListener("mousemove",mouseRotate),setTimeout(function(){document.body.addEventListener("mousemove",mouseRotate),game.elements.startBtn.removeAttribute("disabled"),game.elements.settingsBtn.removeAttribute("disabled"),settingsEnabled?game.elements.fieldCube.classList.add("settingsRotate"):(game.elements.settingsForm.style.display="none",game.elements.fieldCube.classList.remove("settingsRotate"))},1e3*e),degSettings+=180,game.elements.fieldCube.style.transition="transform "+e+"s cubic-bezier(0.450, 0.180, 0.100, 1.385)",game.elements.fieldCube.style.transform=`rotatey(${-degSettings}deg) rotatex(0deg)`},floating:function(e,t,n,s){t+=getRandomInt(-s,s),n+=getRandomInt(-s,s);e.style.transform=`rotatey(${n-degSettings}deg) rotatex(${t}deg)`},disableElementsFunc:function(t,n){for(let e=0;e<t.length;e++)"remove"==n?(t[e].classList.remove("settings__fieldset_disable"),t[e].removeAttribute("disabled")):"add"==n&&(t[e].classList.add("settings__fieldset_disable"),t[e].setAttribute("disabled","disabled"))},getNumberTarget:function(){let e;if(event.target.classList.contains("cell__sideNumber")||event.target.classList.contains("cell__number"))return event.target.classList.contains("cell__sideNumber")?e=event.target.parentNode.parentNode.parentNode:event.target.classList.contains("cell__number")&&(e=event.target.parentNode),Array.prototype.indexOf.call(game.cells.td,e)},clickTarget:function(e){isNaN(parseFloat(e))||(game.states.win?(event.preventDefault(),resetAnimation(game.elements.startBtn,"btn_clickMe"),game.elements.startBtn.classList.add("btn_clickMe"),clickMeSound.play({volume:.1})):game.checkMove(e)&&game.states.canBeMoved&&game.moving(e,!0))},transitionendTarget:function(e){isNaN(parseFloat(e))||(game.cells.td[e].style.transition="none",game.cells.td[e].classList.remove("cell_top","cell_right","cell_bottom","cell_left"),game.draw(),game.cells.newDirection(),game.classUpdate(),game.states.canBeMoved=!0,game.checkWin()&&(game.elements.field.classList.add("field_win"),winSound.play({volume:.3}),game.elements.header.classList.add("header_win")))},updateTable:function(n){let t=document.getElementsByClassName("table"),s=document.getElementsByClassName("table__row"),a=s[0].getElementsByClassName("table__cell");if(n!=s.length){if(n>s.length){var i=n-s.length;for(let e=0;e<i;e++)t[0].appendChild(s[0].cloneNode(!0));var l=a.length;for(let t=0;t<s.length;t++)for(let e=0;e<n-l;e++)s[t].appendChild(a[0].cloneNode(!0))}else if(n<s.length){var m=s.length-n;for(let e=0;e<m;e++)t[0].removeChild(s[s.length-1]);var r=a.length;for(let t=0;t<s.length;t++)for(let e=0;e<r-n;e++){var o=s[t].getElementsByClassName("table__cell");s[t].removeChild(o[o.length-1])}}game.field.width=n,game.field.height=n,game.field.numberOfCells=n*n,game.cells.originalRanking.length=0;for(let e=game.cells.ranking.length=0;e<n*n;e++)n*n-1!=e?(game.cells.originalRanking.push(e+1),game.cells.ranking.push(e+1)):(game.cells.originalRanking.push(null),game.cells.ranking.push(null));game.cells.newBorder(),game.cells.newDirection(),game.draw(),game.classUpdate(),game.timer.stop(),game.timer.reset(),game.states.progress=0,game.elements.progress.textContent=game.states.progress,game.elements.header.classList.remove("header_win"),game.states.win=!0}}});game.elements.settingsForm.addEventListener("change",function(){settingsClick.play({volume:.3});let e=document.getElementsByClassName("table");var t=Number(document.querySelector('input[name="fieldSize"]:checked').value),t=(game.updateTable(t),e[0].classList.remove("table_4","table_5","table_6"),e[0].classList.add("table_"+t),document.querySelector('input[name="theme"]:not(:checked)').value),n=document.querySelector('input[name="theme"]:checked').value,t=(document.body.classList.remove(t),document.body.classList.add(n),document.querySelector('input[name="3Danimation"]:checked').value),n=(game.states.animation3D="true"===t,game.states.animation3D?"remove":"add"),t=(game.disableElementsFunc(game.elements.disableElements,n),document.querySelector('input[name="3DanimationForFocus"]:checked').value);game.states.animationForFocus3D="true"===t,game.settings.sensitivity3D=Number(game.elements.sensitivity3DRange.getAttribute("max"))+Number(game.elements.sensitivity3DRange.getAttribute("min"))-game.elements.sensitivity3DRange.value,game.settings.speed3D=Number(game.elements.speed3DRange.getAttribute("max"))+Number(game.elements.speed3DRange.getAttribute("min"))-game.elements.speed3DRange.value});for(let e=0;e<game.cells.cubes.length;e++)game.cells.cubes[e].addEventListener("transitionend",function(){event.stopPropagation()});function equalArrays(t,n){let s=0;for(let e=0;e<t.length;e++)t[e]==n[e]&&s++;return s}function resetAnimation(e,t){e.classList.remove(t),e.style.animation="none",e.offsetHeight,e.style.animation=null}function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}game.elements.fieldCube.addEventListener("mousedown",function(){game.clickTarget(game.getNumberTarget())}),game.elements.fieldCube.addEventListener("touchstart",function(){game.clickTarget(game.getNumberTarget())}),game.elements.fieldCube.addEventListener("transitionend",function(){event.target.classList.contains("cell")&&game.transitionendTarget(Array.prototype.indexOf.call(game.cells.td,event.target))}),game.draw(),game.elements.startBtn.onclick=function(){var e;btnClickSound.play({volume:.15}),resetAnimation(game.elements.startBtn,"btn_clickMe"),game.elements.field.classList.remove("field_win"),settingsEnabled?(e=Number(game.settings.speed3D)/Number(game.elements.speed3DRange.getAttribute("max"))*(1.15-.8)+.8,settingsEnabled=!1,plusOrMinus=-1,game.flip(),setTimeout(function(){game.timerStart.stop(),game.timerStart.reset(),game.timerStart.start()},1e3*e)):(game.timerStart.stop(),game.timerStart.reset(),game.timerStart.start())};let degSettings=0,plusOrMinus=-1,settingsEnabled=!1,userTouch=(game.elements.settingsBtn.onclick=function(){btnClickSound.play({volume:.15}),settingsEnabled?(settingsEnabled=!1,plusOrMinus=-1,game.states.win||game.timer.start()):(game.elements.settingsForm.style.display="",settingsEnabled=!0,plusOrMinus=1,game.states.win||game.timer.stop()),game.flip()},document.body.addEventListener("keydown",function(e){game.states.win||!game.states.canBeMoved||settingsEnabled||("KeyW"==e.code||"ArrowUp"==e.code?game.moving(game.cells.directions.bottom[0],!0):"KeyD"==e.code||"ArrowRight"==e.code?game.moving(game.cells.directions.left[0],!0):"KeyS"==e.code||"ArrowDown"==e.code?game.moving(game.cells.directions.top[0],!0):"KeyA"!=e.code&&"ArrowLeft"!=e.code||game.moving(game.cells.directions.right[0],!0))}),!1);document.body.addEventListener("touchstart",function(){userTouch=!0});let floatingSet,count=0;function mouseRotate(e){if(count++,userTouch||count%10==0){let n;n=game.settings.speed3D<.5?"linear":"cubic-bezier(0.225, 0.540, 0.235, 0.900)",game.settings.speed3D<=.3&&(game.settings.speed3D=.3),game.elements.fieldCube.style.transition="transform "+game.settings.speed3D+"s "+n;var t=game.elements.fieldCube.getBoundingClientRect(),s=e.clientX-t.left,a=e.clientY-t.top;if(e.clientX>t.left&&e.clientX<t.right&&e.clientY>t.top&&e.clientY<t.bottom&&!game.states.animationForFocus3D||!game.states.animation3D){if(clearInterval(floatingSet),n="linear",game.elements.fieldCube.style.transition="transform 0.4s "+n,game.elements.fieldCube.style.transform=`rotatey(${-degSettings}deg) rotatex(0deg)`,game.cells.cubes[0].classList.contains("cell__cube_3D"))for(let e=0;e<game.cells.cubes.length;e++)game.cells.cubes[e].classList.remove("cell__cube_3D")}else{clearInterval(floatingSet);let e=Math.round((s-game.elements.fieldCube.offsetWidth/2)/game.settings.sensitivity3D),t=Math.round((a-game.elements.fieldCube.offsetHeight/2)/game.settings.sensitivity3D*+plusOrMinus);if(game.elements.fieldCube.style.transform=`rotatey(${e-degSettings}deg) rotatex(${t}deg)`,!game.cells.cubes[0].classList.contains("cell__cube_3D"))for(let e=0;e<game.cells.cubes.length;e++)game.cells.cubes[e].classList.add("cell__cube_3D");floatingSet=setTimeout(function(){n="linear",game.elements.fieldCube.style.transition="transform 7s "+n,game.floating(game.elements.fieldCube,t,e,10),floatingSet=setInterval(function(){game.floating(game.elements.fieldCube,t,e,15)},7e3)},1e3*game.settings.speed3D)}}}